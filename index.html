<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
/*    font-family: 'Roboto Condensed', sans-serif;*/
    font: 14px/16px "Helvetica Neue", Helvetica, Arial, sans-serif;
}

    
.states {
  fill: #ccc;
  stroke: #fff;
}

.symbol{
    fill: #67a9cf;
    stroke: #67a9cf;
    opacity: 0.65;
}
    
.symbol:hover {
    fill-opacity: 1;
    stroke-width: 1px;
}

.symbol--gain{
  fill: #67a9cf;
  stroke: #67a9cf;
  fill-opacity: .65;
  stroke-opacity: 1;
}
.symbol--loss{
    fill: #ef8a62;
    stroke: #ef8a62;   
    fill-opacity: .65;
    stroke-opacity: 1;
}
    
.land {
  fill: #f7f7f7;
  stroke: #ccc;
}

.state-boundary {
  fill: none;
  stroke: #bbb;
}



div.tooltip {   
 	position: absolute;   
    background-color: white; 
	text-align: center;    
	padding: 10px;             
	font-size: 12px;        
	border: 1px solid #ccc;     
	border-radius: 5px;           
	pointer-events: none;  
    -webkit-box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.25);
    -moz-box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.25);
    box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.25);
}

#sliderContainer {
    text-align: center;
    position: relative;
    top: 500px;


</style>
<head>
    <link rel="stylesheet" href="css/main.css" />
    <title>Nuclear Power in the U.S.</title>
</head>
<body>
<!--<h1>Net Change in Nuclear Capacity</h1>-->
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script src="//d3js.org/queue.v1.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
<div id="slider-container">
  <div id="slider-div"></div>
  <div id="slider-probe">
    <p></p>
    <div></div>
  </div>
</div>
<div id="map-container"></div>



<script>

var width = 960,
    height = 600;

//var inputValue = null;
//var year = ["1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023", "2024", "2025", "2026", "2027"];
    
var radius = d3.scale.sqrt()
    .domain([0, 1e6])
    .range([0, 10]);

var path = d3.geo.path();

var svg = d3.select("body")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

var div = d3.select("body")
		    .append("div")   
    		.attr("class", "tooltip")               
    		.style("opacity", 0);
    
var projection = d3.geo.albersUsa();

//queue()
//    .defer(d3.json, "us.json")
//    .defer(d3.csv, "nuc_sequence.csv")
//    .defer(d3.csv, "nuc_first.csv")
//    .await(ready);
    
//function ready(error, us, sequence, first) {
//  if (error) throw error;
//
//  svg.append("path")
//      .attr("class", "states")
//      .datum(topojson.feature(us, us.objects.states))
//      .attr("d", path); 
//    
//  svg.selectAll(".symbol")
//      .data(sequence)
//      .enter()
//      .append("circle")
//      .attr("class", function(d) { return "symbol symbol--" + (d.cum_capacity < 0 ? "loss" : "gain"); })
//      .attr("cx", function(d) {
//        return projection([d.longitude, d.latitude])[0];})
//      .attr("cy", function(d) {
//        return projection([d.longitude, d.latitude])[1];})
//      .attr("r", function(d) {
//        return Math.abs(d.cum_capacity)/70;})
//      .attr("vector-effect","non-scaling-stroke")
//      .on("mouseover", function(d) {
//        div.transition()
//            .style("left", (d3.event.pageX + 10) + "px")
//            .style("top", (d3.event.pageY - 80) + "px")
//            .duration(200) 
//            .style("opacity", .9);
//        div.html("<strong>" + d.plant_name + "</strong><br/>" + Math.abs( d.cum_capacity ) + " MW " + ( d.cum_capacity < 0 ? "lost" : "installed" ) + "<br/>" + d.city + ", " + d.state)
//              
//	   }) 
//      .on("mouseout", function(d) {       
//        div.transition()        
//           .duration(500)      
//           .style("opacity", 0);   
//        });
//    
//}
    
 
var g = svg.append("g");

g.append( "rect" )
  .attr("width",width)
  .attr("height",height)
  .attr("fill","white")
  .attr("opacity",0)
  .on("mouseover",function(){
    hoverData = null;
    if ( probe ) probe.style("display","none");
  })

var map = g.append("g")
    .attr("id","map");
    
d3.json("us.json", function(error, us) {

    
  map.selectAll("path")
      .data(topojson.feature(us, us.objects.states).features)
      .enter()
      .append("path")
      .attr("vector-effect","non-scaling-stroke")
      .attr("class","land")
      .attr("d", path);

   map.append("path")
       .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
       .attr("class", "state-boundary")
       .attr("vector-effect","non-scaling-stroke")
       .attr("d", path);

//  d3.select("body")
//    .append("div")
//    .attr("id","loader")
//    .style("top",d3.select("#play").node().offsetTop + "px")
//    .style("height",d3.select("#date").node().offsetHeight + d3.select("#map-container").node().offsetHeight + "px")

  d3.csv("nuc_sequence.csv",function(data){
    var first = data[0];

    // draw city points 
    for ( var i in data ){
      var projected = projection([ parseFloat(data[i].longitude), parseFloat(data[i].latitude) ])
      map.append("circle")
        .datum( data[i] )
        .attr("cx",projected[0])
        .attr("cy",projected[1])
        .attr("r",1)
        .attr("vector-effect","non-scaling-stroke")
        .on("mousemove",function(d){
          hoverData = d;
          setProbeContent(d);
          probe
            .style( {
              "display" : "block",
              "top" : (d3.event.pageY - 80) + "px",
              "left" : (d3.event.pageX + 10) + "px"
            })
        })
        .on("mouseout",function(){
          hoverData = null;
          probe.style("display","none");
        })
    }

    createLegend();

    dateScale = createDateScale(orderedColumns).range([0,500]);
    
    createSlider();

    d3.select("#play")
      .attr("title","Play animation")
      .on("click",function(){
        if ( !isPlaying ){
          isPlaying = true;
          d3.select(this).classed("pause",true).attr("title","Pause animation");
          animate();
        } else {
          isPlaying = false;
          d3.select(this).classed("pause",false).attr("title","Play animation");
          clearInterval( interval );
        }
      });

//    drawMonth( orderedColumns[currentFrame] ); // initial map

    window.onresize = resize;
    resize();

    d3.select("#loader").remove();

  })

});

function animate(){
  interval = setInterval( function(){
    currentFrame++;

    if ( currentFrame == orderedColumns.length ) currentFrame = 0;

    d3.select("#slider-div .d3-slider-handle")
      .style("left", 100*currentFrame/orderedColumns.length + "%" );
    slider.value(currentFrame)

    drawMonth( orderedColumns[ currentFrame ], true );

    if ( currentFrame == orderedColumns.length - 1 ){
      isPlaying = false;
      d3.select("#play").classed("pause",false).attr("title","Play animation");
      clearInterval( interval );
      return;
    }

  },frameLength);
}
    
    
                                                 
</script>
