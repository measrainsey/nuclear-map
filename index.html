<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
/*    font-family: 'Roboto Condensed', sans-serif;*/
    font: 14px/16px "Helvetica Neue", Helvetica, Arial, sans-serif;
}

    
.states {
  fill: #ccc;
  stroke: #fff;
}

/*
.symbol {
  fill: steelblue;
  fill-opacity: .7;
  stroke: #fff;
}
    
.symbol:hover {
  fill: #ef8a62;
  fill-opacity: .65;
  stroke: #000;
  stroke-width: 2px;
}
*/
    
.symbol{
    fill: steelblue;
    stroke: #fff;
    opacity: .65;
}
    
.symbol:hover {
    fill-opacity: .75;
    stroke: #000;
    stroke-width: 1px;
}

.symbol--gain{
  fill: #67a9cf;
  stroke: #fff;
}
.symbol--loss{
  fill: #ef8a62;
  stroke: #fff;
}

div.tooltip {   
 	position: absolute;   
    background-color: white; 
	text-align: center;    
	padding: 10px;             
	font-size: 12px;        
	border: 1px solid #ccc;     
	border-radius: 5px;           
	pointer-events: none;  
    -webkit-box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.25);
    -moz-box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.25);
    box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.25);
}

#sliderContainer {
    text-align: center;
    position: relative;
    top: 500px;


</style>
<head>
    <title>Symbol Map</title>
</head>
<body>
<!--<h1>Net Change in Nuclear Capacity</h1>-->
<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script src="//d3js.org/queue.v1.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
<!--<div id="slider" style="width: 200px;"></div>-->
<!--
<div id="sliderContainer">
    <input id="timeslide" type="range" min="0" max="58" value="0" step="1"/><br>
    <span id="range">1969</span>
</div>
-->

<script>

$(document).ready(function() {

$("#slider").slider({
	value:2000,
	min: 1971,
	max: 2006,
	step: 1,
	slide: function( event, ui ) {
		$("#year").val(ui.value);
		redraw(ui.value.toString());
	}
});
$("#year").val($("#slider").slider("value") );


var width = 960,
    height = 500;
    
//var inputValue = null;
//var month = ["1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009","2010","2011","2012","2013","2014","2015","2016","2017","2018","2019","2020","2021","2022","2023","2024","2025","2026","2027"];


var radius = d3.scale.sqrt()
    .domain([0, 1e6])
    .range([0, 10]);

var path = d3.geo.path();

var svg = d3.select("body")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

var div = d3.select("body")
		    .append("div")   
    		.attr("class", "tooltip")               
    		.style("opacity", 0);

var projection = d3.geo.albersUsa();
    

    
//function ready(error, us, centroid) {
//  if (error) throw error;
//
//  svg.append("path")
//      .attr("class", "states")
//      .datum(topojson.feature(us, us.objects.states))
//      .attr("d", path);
//
//  svg.selectAll(".symbol")
//      .data(centroid.features.sort(function(a, b) { return b.properties.population - a.properties.population; }))
//    .enter().append("path")
//      .attr("class", "symbol")
//      .attr("d", path.pointRadius(function(d) { return radius(d.properties.population); }));
//}

queue()
    .defer(d3.json, "us.json")
    .defer(d3.csv, "dtall.csv")
    .await(ready);
    
function ready(error, us, data) {
  if (error) throw error;

  svg.append("path")
      .attr("class", "states")
      .datum(topojson.feature(us, us.objects.states))
      .attr("d", path);

  svg.selectAll(".symbol")
      .data(data)
      .enter()
      .append("circle")
//      .attr("class", "symbol")
    .attr("class", function(d) { return "symbol symbol--" + (d.capacity < 0 ? "loss" : "gain"); })
      .attr("cx", function(d) {
        return projection([d.longitude, d.latitude])[0];})
      .attr("cy", function(d) {
        return projection([d.longitude, d.latitude])[1];})
      .attr("r", function(d) {
        return Math.abs(d.capacity)/70;})
      .attr("vector-effect","non-scaling-stroke")
      .on("mouseover", function(d) {
        div.transition()
            .style("left", (d3.event.pageX + 10) + "px")
            .style("top", (d3.event.pageY - 80) + "px")
            .duration(200) 
            .style("opacity", .9);
//        div.text(d.plant_name)
        div.html("<strong>" + d.plant_name + "</strong><br/>" + Math.abs( d.capacity ) + " MW " + ( d.capacity < 0 ? "lost" : "gained" ) + "<br/>" + d.city + ", " + d.state)
              
	   }) 
      .on("mouseout", function(d) {       
        div.transition()        
           .duration(500)      
           .style("opacity", 0);   
        });
    }

//// when the input range changes update the value 
//d3.select("#timeslide").on("input", function() {
//    update(+this.value);
//});
//
//// update the fill of each SVG of class "incident" with value
//function update(value) {
//    document.getElementById("range").innerHTML=month[value];
//    inputValue = month[value];
//    d3.selectAll(".incident")
//        .attr("fill", dateMatch);
//}
//

                                                 
</script>
